
# Exploiting "Group Policy Preferences" AKA MS14-025 in windows environment to gain Admin user password.

If “Domain Controller” machine is having "Windows 2008" or "Windows 2012" server and it’s not having "The Group Policy Preference Credential Patch (KB2962486)" applied in it, any authenticated domain user (normal domain user) can grab the XML file from SYSVOL directory of the “Domain Controller” machine which contains password for “Domain Administrator” user.

The file "Groups.xml" contain the "administrator" password for the "Domain admin" user in encrypted form which is "AES-256" bit encryption but Microsoft released the private key for the encryption. Since authenticated users (any domain user or users in a trusted domain) have read access to SYSVOL, anyone in the domain can search the SYSVOL share for XML files containing "cpassword" which is the value that contains the AES encrypted password.

This vulnerability is staright forward to exploit.
Requirement: Attacker must have access to machine either Command prompt or web shell one.

Let's assume, attacker is having access to a machine which is connected to Windows Domain. 
Run from command prompt or web shell to check the Domain name to which machine is connected:

    set user
 
 <img src="https://raw.githubusercontent.com/incredibleindishell/Windows-AD-environment-related/master/Exploiting-GPP-AKA-MS14_025-vulnerability/images/1.1%20cmd.png">

Output of the command shows the DNS, Domain Name and username of the currently logged in user
<img src="https://raw.githubusercontent.com/incredibleindishell/Windows-AD-environment-related/master/Exploiting-GPP-AKA-MS14_025-vulnerability/images/1%20cmd.png">

After getting the Windows Domain name, make SMB request by specifying the domain name

    \\domain_name
In my case, domain name is "DC3"

    \\DC3\
<img src="https://raw.githubusercontent.com/incredibleindishell/Windows-AD-environment-related/master/Exploiting-GPP-AKA-MS14_025-vulnerability/images/2.1.png">

We need to access "SYSVOL" directory after accessing Domain name share.

<img src="https://raw.githubusercontent.com/incredibleindishell/Windows-AD-environment-related/master/Exploiting-GPP-AKA-MS14_025-vulnerability/images/3.png">

In "SYSVOL" directory, access the domain name directory and we need to navigate to "Policies" directory.
"Policies" directory may have multiple directories with random name.

<img src="https://raw.githubusercontent.com/incredibleindishell/Windows-AD-environment-related/master/Exploiting-GPP-AKA-MS14_025-vulnerability/images/4.png">

Access every directory with random name and check for following directory inside them 

    Machine->Preferences->Groups

If directory is present, it should have "Groups.xml" file present in it. This Groups.xml file will have encrypted password of the "administrator" user account.

<img src="https://raw.githubusercontent.com/incredibleindishell/Windows-AD-environment-related/master/Exploiting-GPP-AKA-MS14_025-vulnerability/images/6.png">

<img src="https://raw.githubusercontent.com/incredibleindishell/Windows-AD-environment-related/master/Exploiting-GPP-AKA-MS14_025-vulnerability/images/7.png">

The value of "cpassword" is the encrypted password of the "administrator" user, copy it and we can get plain text password using script 
Command is

    ruby gppdecrypt.rb <encrypted_password>

<img src="https://raw.githubusercontent.com/incredibleindishell/Windows-AD-environment-related/master/Exploiting-GPP-AKA-MS14_025-vulnerability/images/8.png">

We can also get "Groups.xml" file just by issuing below mentioned command 

    findstr /S cpassword \\domain_name\SYSVOL\*.xml

<img src="https://raw.githubusercontent.com/incredibleindishell/Windows-AD-environment-related/master/Exploiting-GPP-AKA-MS14_025-vulnerability/images/9.png">

Output of the command will be like this

<img src="https://raw.githubusercontent.com/incredibleindishell/Windows-AD-environment-related/master/Exploiting-GPP-AKA-MS14_025-vulnerability/images/10.png">

--==[[Greetz to]]==--

zero cool, code breaker ica, root_devil, google_warrior, INX_r0ot,Darkwolf indishell, Baba, Silent poison India, Magnum sniper, ethicalnoob Indishell, Local root indishell, Irfninja indishell, Reborn India, L0rd Crus4d3r, cool toad, Hackuin, Alicks, Gujjar PCP, Bikash, Dinelson Amine, Th3 D3str0yer, SKSking, rad paul, Godzila, mike waals, zoo zoo, cyber warrior, shafoon, Rehan manzoor, cyber gladiator, 7he Cre4t0r, Cyber Ace, Golden boy INDIA, Ketan Singh, Yash, Aneesh Dogra, AR AR, saad abbasi, hero, Minhal Mehdi, Raj bhai ji, Hacking queen, lovetherisk, D2 and rest of TEAM INDISHELL

--==[[Love to]]==--

My Father,Ritu Tomer Rathi,cold fire hacker, Mannu, ViKi, Ashu bhai ji, Soldier Of God, Bhuppi, Gujjar PCP, rafay baloch
Mohit, Ffe, Ashish, Shardhanand, Budhaoo, Jagriti, Salty, Hacker fantastic, Jennifer Arcuri, Don(Deepika kaushik) and all lovely people around the world <3
